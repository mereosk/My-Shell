Τμήμα Πληροφορικής και Τηλεπικοινωνιών
Κωνσταντίνος Μερεός sdi1700085
Προγραμματισμός Συστήματος
Εργασία 1

Execution and Separate Compilation

To πρόγραμμά μου αποτελείται από 3 directories το include, modules και program. Στο φάκελο programs υπάρχει το κύριο πρόγραμμα
το mysh.c, το οποίο περιέχει τη main συνάρτηση. Στη συνέχεια στο φάκελο modules υπάρχει το αρχείο parsing.c στο οποίο γίνεται 
το parse των εντολών του shell μου. Μέσα από το parsing.c καλούνται λειτουργείες οι οποίες φτιάχνουν τη διεπαφή με το shell μου,
έτσι τις έχω χωρίσει αυτές στο αρχείο bash_interface.c. Αυτό επίσης το έκανα για να μην βγει πολύ εκτενές το parsing.c. Έπειτα
στο modules έχω τα αρχεία ADTList.c, ADTMap.c, ADTVector.c. Τα προηγούμενα είναι, αντίστοιχα, υλοποιήσεις λίστας, πίνακα κατακερμα-
τισμού καθώς και ένας δυναμικός πίνακας. Να τονίσω ότι οι υλοποιήσεις των προηγούμενων δομών είναι "εμπνευσμένες" από τις δομές
του κ.Χατζηκοκολάκη το 2020. Έχουν γίνει φυσικά αρκετές αλλαγές, αλλά εφόσον μπορούσαμε να χρησιμοποιήσουμε STL για τη C++ δεν
έφτιαξα από την αρχή δομές. Επίσης να τονίσω ότι είχα ρωτήσει στο μάθημα για αυτό και μου είχατε πει ότι δεν πειράζει αν ήταν 
μόνο οι δομές. Φυσικά όλες οι αρχικοποιήσεις των συναρτήσεων που βρίσκονται μέσα στα αρχεία που μόλις περιέγραψα βρίσκονται 
στο φάκελο include σε αντίστοιχα αρχεία .h. Τέλος υπάρχει το Makefile (βρίσκεται εκτός των directory που περιέγραψα) το οποίο 
με τη χρήση make μεταγλωττίζει το πρόγραμμά μου. Πιο συγκεκριμένα, παρακάτω παραθέτω τα βήματα για την εκτέλεση του προγράμματος.

1. Βρίσκομαι έξω από τα directories. Δηλαδή με το ls μου εμφανίζονται τα include, modules και program.
2. Πατάω make και εκτελείται η μεταγλώττιση του προγράμματος
3. Πατάω ./program/mysh και εκτελείται το mysh

Να προσθέσω ότι υπάρχει δυνατότητα make run, που μεταγλωττίζει και εκτελεί το πρόγραμμα απευθείας καθώς και make valgrind που
καλεί τον debugger αλλά υπάρχει το θέμα ότι δεν γίνειται block το σήμα SIGTSTP λόγω ιδιομορφίας του Makefile. Άρα δεν θα πρό-
τεινα να το εκτελέσετε έτσι.

Parsing


History, aliases, wildcharacters, change directory and environment variables

Το ιστορικό είναι ένας δυναμικός πίνακας(Vector) ο οποίος αρχικοποιήται στην αρχή του προγράμματος και ενημερώνεται μετά από
κάθε εντολή που διαβάζει το shell. Αν γράψουμε history ή myHistory τότε γίνεται print αυτός ο δυναμικός πίνακας και έτσι μπο-
ρούμε να δούμε τις προηγούμενες εντολές. Μία αλλαγή που έκανα σε σχέση με τα ζητούμενα της άσκησης είναι να μην περιορίζω στο 
πόσες εντολές μπορώ να θυμάμαι (20 ήταν το ζητούμενο), αλλά χρησιμοποίησα δυναμικό πίνακα ο οποίος κάθε φορά που φτάνει στα 
όριά του διπλασιάζει τη χωρητικότητα επί δύο. Να προσθέσω επίσης, ότι αν γράψουμε μια εντολή και αυτή είναι ίδια με την τελευταία
που είχαμε γράψει τότε δεν ξανακαταγράφεται στον δυναμικό πίνακα.

Εν συνεχεία υλοποίησα τη δυνατότητα myHistory n, αλλά με τη χρήση του θαυμαστικού (!n argument). Συγκεκριμένα υπάρχει δυνατό-
τητα 
1. !n το οποίο αναφέρεται στην n εντολή που υπάρχει στο history Vector
2. !-n το οποίο αναφέρεται στην εντολή n φορές πριν την τελευταία που έχουμε γράψει
3. !! το οποίο αναφέρεται στην προηγούμενη ακριβώς εντολή
4. !string το οποίο ψάχνει τον history vector για την εντολή η οποία αρχίζει με string και επιστρέφει την πιο πρόσφατη

Εννοείται ότι για τα προηγούμενα υπάρχει error handling σε περίπτωση που δεν υπάρχει event αλλά και η δυνατότητα να προσθέσουμε
arguments δηλαδή αν η 2η εντολή που γράψαμε είναι ls μπορούμε να κάνουμε !2 modules και να εκτελεστεί το ls modules.

Όσο αφορά τα aliases, υλοποιούνται με ένα Map (hash table). Έτσι όταν έχουμε createalias myhome "/home/some/thing" τότε σαν 
key μπαίνει η συμβολοσειρά myhome και σαν value το "/home/some/thing". Το hash function που έχω υλοποιήσει είναι η djb2
συνάρτηση και την επέλεξα, διότι είναι απλή, γρήγορα και σε γενικές γραμμές αποδοτική. Εννοείται, ότι πριν από την εκτέ-
λεση μιας εντολή πάντα τσεκάρετε το αν υπάρχει alias.

Όπως είπα και πιο πάνω, υπάρχει μία λίστα η οποία περιέχει τις λίστες με τα arguments κάθε εντολής. Αυτή η λίστα με λίστες
κάθε φορά πριν εκτελεστούν οι εντολές με την execute_command, διατρέχεται και με τη βοήθεια της glob αντικαθιστώνται τυχόν
wildcharacters. 

Να αναφέρω ότι η λειτουργία του change directory έχει υλοποιηθεί πλήρως με τη βολήθεια της συνάρτησης chdir. Τέλος, για την
αντιμετώπιση των μεταβλητών περιβάλλοντος γίνεται το εξής. Στην αρχή του parsing, διατρέχεται όλη η εντολή μέχρι να αντικα-
τασταθούν όλες οι environment variables. Για αυτή τη δουλειά έχω υλοποιήσει τη συνάρτηση replace_enc_vars.

